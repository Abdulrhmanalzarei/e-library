{% extends "base.html" %}
{% load static %}

{% block title %}Books Store{% endblock %}

{% block content %}

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold">Books Collection</h2>
        <p class="text-muted mb-0">Browse our curated selection of books</p>
    </div>

    {% if user.is_authenticated and user.is_staff %}
    <div>
        <a href="{% url 'books:book_create' %}" class="btn btn-primary btn-sm">
            + Add Book
        </a>
        <a href="{% url 'books:authors_list' %}" class="btn btn-outline-secondary btn-sm ms-1">
            Authors
        </a>
        <a href="{% url 'books:categories_list' %}" class="btn btn-outline-secondary btn-sm ms-1">
            Categories
        </a>
    </div>
    {% endif %}
</div>

<!-- Books Grid -->
<div class="row g-4">

    {% for book in books %}
    <div class="col-lg-3 col-md-4 col-sm-6">
        <div class="card h-100 shadow-sm border-0">

            <!-- Book Cover -->
            {% if book.cover %}
                <img src="{{ book.cover.url }}" class="card-img-top" alt="{{ book.title }}"
                     style="height:260px; object-fit:cover;">
            {% else %}
                <img src="{% static 'img/no-book.png' %}" class="card-img-top"
                     style="height:260px; object-fit:cover;">
            {% endif %}

            <div class="card-body d-flex flex-column">

                <h6 class="fw-bold text-truncate">{{ book.title }}</h6>

                <!-- Authors -->
                <p class="small text-muted mb-1">
                    {% for author in book.authors.all %}
                        {{ author.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        Unknown Author
                    {% endfor %}
                </p>

                <!-- Categories -->
                <p class="small mb-2">
                    {% for category in book.categories.all %}
                        <span class="badge bg-light text-dark border">
                            {{ category.name }}
                        </span>
                    {% endfor %}
                </p>

                <!-- Price -->
                <p class="fw-bold text-success mb-3">
                    {{ book.price }} $
                </p>

                <!-- Buttons -->
                <div class="mt-auto d-flex justify-content-between align-items-center">

                    <a href="{% url 'books:book_detail' book.slug %}"
                       class="btn btn-sm btn-outline-primary">
                        View
                    </a>

                    {% if user.is_authenticated and user.is_staff %}
                        <a href="{% url 'books:book_delete' book.pk %}"
                           class="btn btn-sm btn-outline-danger">
                            Delete
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info text-center">
            No books available at the moment.
        </div>
    </div>
    {% endfor %}

</div>

<!-- Pagination -->
{% if books.has_other_pages %}
<nav class="mt-5">
    <ul class="pagination justify-content-center">

        {% if books.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ books.previous_page_number }}">Previous</a>
        </li>
        {% endif %}
{% if user.is_staff %}
<form method="post" action="{% url 'books:book_delete' book.pk %}">
    {% csrf_token %}
    <button class="btn btn-danger btn-sm">Delete / Disable</button>
</form>
{% endif %}
        {% for page_num in books.paginator.page_range %}
            {% if books.number == page_num %}
                <li class="page-item active">
                    <span class="page-link">{{ page_num }}</span>
                </li>
            {% else %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% if books.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ books.next_page_number }}">Next</a>
        </li>
        {% endif %}

    </ul>
</nav>
{% endif %}

{% endblock %}
